#pragma config(Sensor, port2,  colorSensor,    sensorVexIQ_ColorHue)
#pragma config(Motor,  motor1,          leftDrive,     tmotorVexIQ, PIDControl, encoder)
#pragma config(Motor,  motor5,          revolver,      tmotorVexIQ, PIDControl, encoder)
#pragma config(Motor,  motor6,          rightDrive,    tmotorVexIQ, PIDControl, reversed, encoder)
#pragma config(Motor,  motor8,          conveyor,      tmotorVexIQ, PIDControl, encoder)
#pragma config(Motor,  motor10,         dumper,        tmotorVexIQ, PIDControl, encoder)
#pragma config(Motor,  motor11,         fifthWheel,    tmotorVexIQ, PIDControl, encoder)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

void setDriveMotorsState()
{
		bool isHorizontalDrive = abs(vexRT[ChC]) > 50;

		if (isHorizontalDrive == true)
		{
				if (vexRT[ChC] > 0)
				{
						motor[fifthWheel] = vexRT[ChC] - 50;
				}
				else
				{
						motor[fifthWheel] = vexRT[ChC] + 50;
				}

				motor[leftDrive] = 0;
				motor[rightDrive] = 0;
		}
		else
		{
				motor[fifthWheel] = 0;

				motor[leftDrive] = vexRT[ChA];
				motor[rightDrive] = vexRT[ChD];
		}
}

void setConveyorBeltMotorState()
{
		if (vexRT[BtnRUp] == true)
		{
				motor[conveyor] = 100;
		}
		if (vexRT[BtnRDown] == true)
		{
				motor[conveyor] = 0;
		}
}

void processColorSensor()
{
		int blueChannel = getColorBlueChannel(port2);
		int redChannel = getColorRedChannel(port2);
		int greenChannel = getColorGreenChannel(port2);

		writeDebugStreamLine("%3d    %3d     %3d", redChannel, greenChannel, blueChannel);

		if (blueChannel > redChannel && blueChannel > greenChannel && blueChannel > 5) {
				// blue
				setMotorTarget(motor5, 120, 100);

		} else if (redChannel > blueChannel && redChannel > greenChannel && redChannel > 5) {
				// red
				setMotorTarget(motor5, -120, 100);
		} else if (greenChannel > 5) {
				// green
				setMotorTarget(motor5, 0, 100);
		}
}

task main()
{
		setColorMode(port2, colorTypeRGB_Hue_Reflected);

		while (true)
		{
			setDriveMotorsState();
			setConveyorBeltMotorState();
			processColorSensor();

				//writeDebugStreamLine("%d", vexRT[ChC]);
		}
}
